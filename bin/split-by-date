#!/usr/bin/env bash

name=$1
col=$2
shift
shift

set -e
set -u

if [ "$name" == "" ]
then
        echo "$0 name column [file.gz [file2.gz]]"
        exit
fi

zcat $@ | cut -f$col| cut -f1 -d' '| uniq.pl \
| while read date
do
        echo $date
        zcat $@                                                                 	\
        | perl -F'\t' -lane 'print join("\t", @F) if($F['$col'-1] =~ /^'$date'/);'	\
	| gzip \
	> $date-$name.gz

#        gzip -v $date-$name-??
#        | split -l 200000 - $date-$name-
done

